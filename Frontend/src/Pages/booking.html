<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Amusement Park Booking</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-indigo-600 to-purple-700 min-h-screen flex items-center justify-center">

<div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-3xl">
  
  <h1 class="text-3xl font-bold text-center mb-2">ðŸŽ¢ Amusement Park Booking</h1>
  <p class="text-center text-gray-500 mb-6">Book your adventure in seconds</p>

  <form id="bookingForm" class="space-y-4">

    <!-- User Info -->
    <div class="grid grid-cols-2 gap-4">
      <input type="text" id="name" placeholder="Full Name" class="input" required>
      <input type="email" id="email" placeholder="Email" class="input" required>
      <input type="tel" id="phone" placeholder="Phone" class="input" required>
      <input type="date" id="date" class="input" required>
    </div>

    <!-- Ticket Type -->
    <div>
      <label class="font-semibold">Ticket Type</label>
      <select id="type" class="input">
        <option value="normal">Normal Ticket (â‚¹500)</option>
        <option value="premium">Premium Ticket (â‚¹900)</option>
        <option value="membership">Membership â€“ 1 Month (â‚¹3000)</option>
      </select>
    </div>

    <!-- People -->
    <div>
      <label class="font-semibold">Number of People</label>
      <input type="number" id="people" value="1" min="1" class="input">
    </div>

    <!-- Membership Extra -->
    <div id="membershipSection" class="hidden">
      <label class="font-semibold">Upload Photo (for Membership ID)</label>
      <input type="file" id="photo" class="input">
    </div>

    <!-- Addons -->
    <div class="flex gap-6">
      <label class="flex items-center gap-2">
        <input type="checkbox" id="parking">
        Parking (+â‚¹100)
      </label>

      <label class="flex items-center gap-2">
        <input type="checkbox" id="food">
        Food (+â‚¹200/person)
      </label>
    </div>

    <!-- Price Box -->
    <div class="bg-gray-100 p-4 rounded-xl">
      <h2 class="text-lg font-semibold">Total Amount</h2>
      <p class="text-3xl font-bold text-green-600">â‚¹ <span id="total">0</span></p>
    </div>

    <!-- Submit -->
    <button type="submit"
      class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl text-lg font-semibold">
      Pay & Get OTP (Test Mode)
    </button>

  </form>
</div>

<script>
const name = document.getElementById("name");
const email = document.getElementById("email");
const phone = document.getElementById("phone");
const dateEl = document.getElementById("date");
const typeEl = document.getElementById("type");
const peopleEl = document.getElementById("people");
const parkingEl = document.getElementById("parking");
const foodEl = document.getElementById("food");
const totalEl = document.getElementById("total");
const membershipSection = document.getElementById("membershipSection");

// Price Logic
function calculateCost() {
  let type = typeEl.value;
  let people = parseInt(peopleEl.value);

  let base = 0;
  if(type === "normal") base = 500;
  if(type === "premium") base = 900;
  if(type === "membership") base = 3000;

  let total = base * people;

  if(parkingEl.checked) total += 100;
  if(foodEl.checked) total += 200 * people;

  totalEl.innerText = total;
}

// Events
[typeEl, peopleEl, parkingEl, foodEl].forEach(el => {
  el.addEventListener("change", calculateCost);
});

// Membership toggle
typeEl.addEventListener("change", () => {
  if(typeEl.value === "membership") {
    membershipSection.classList.remove("hidden");
  } else {
    membershipSection.classList.add("hidden");
  }
});

// Initial calc
calculateCost();

// Validity Logic
function calculateValidity(startDate, type) {
  let from = new Date(startDate);
  let till = new Date(startDate);

  if(type === "membership") {
    till.setDate(till.getDate() + 30); // 30 days
  } else {
    till = from; // same day
  }

  return {
    validFrom: from.toISOString().split("T")[0],
    validTill: till.toISOString().split("T")[0]
  };
}

// Submit
document.getElementById("bookingForm").addEventListener("submit", async e => {
  e.preventDefault();

  const validity = calculateValidity(dateEl.value, typeEl.value);

  const bookingData = {
    name: name.value,
    email: email.value,
    phone: phone.value,
    bookingDate: dateEl.value,
    type: typeEl.value,
    people: peopleEl.value,
    parking: parkingEl.checked,
    food: foodEl.checked,
    total: totalEl.innerText,
    validFrom: validity.validFrom,
    validTill: validity.validTill
  };

  // Save for next pages
  localStorage.setItem("bookingData", JSON.stringify(bookingData));
  localStorage.setItem("userEmail", bookingData.email);

  // Send OTP
  await fetch("http://localhost:3000/send-otp", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ email: bookingData.email })
  });

  alert("OTP sent to your email!");
  window.location.href = "otp.html";
});
</script>

<style>
.input {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 10px;
}
</style>

</body>
</html>
